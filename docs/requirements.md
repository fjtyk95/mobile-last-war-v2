# Mobile Last War v2 - 要件定義書

## 📋 プロジェクト概要

### プロジェクト名
Mobile Last War v2

### プロジェクト目標
スマートフォン向けの本格的なシューティングゲームを段階的に開発し、継続的にアップデートを行う。現在のシンプルなゲームから、高度なゲーム機能、PWA対応、視覚効果を段階的に実装する。

### ターゲットユーザー
- スマートフォンゲームユーザー（主に10～40代）
- カジュアルゲーマー
- ハードコアシューティングゲームファン
- PWAアプリを利用するユーザー

## 🎯 機能要件

### Phase 1: 基本ゲーム機能強化（現在完了）
- [x] 基本的なシューティングゲーム
- [x] タッチ操作対応
- [x] 敵スポーン・移動システム
- [x] 当たり判定
- [x] スコアシステム

### Phase 2: ゲームシステム拡張（✅ 完了）
- [x] **プレイヤーライフ・ヘルスシステム**
  - HP表示・ダメージ処理・ゲームオーバー条件
  - 無敵時間システム
- [x] **パワーアップシステム**
  - アイテム出現ロジック（敵撃破時30%確率）
  - 弾で撃破 vs 直接触れる仕様
  - 攻撃力アップ・ダウン効果
- [x] **改良されたUI**
  - ポーズ機能・ゲームオーバー画面・リスタート機能
  - ヘルスバー・統計表示

### Phase 2.5: 操作システム改善（📋 計画中）
- [ ] **プレイヤー操作最適化**
  - 画面下部固定位置での左右移動のみ
  - 自動連射システム（手動射撃廃止）
  - モバイル最適化された操作感
- [ ] **難易度バランス調整**
  - 敵出現頻度の最適化
  - ダメージ量の調整
  - パワーアップ効果の見直し
- [ ] **ゲームプレイ改善**
  - より直感的な操作
  - 集中力を要する連続回避アクション

### Phase 3: 敵・AI システム
- [ ] **複数の敵タイプ**
  - Basic: 直線移動
  - Fast: ジグザグ移動  
  - Tank: 高耐久・低速
  - Boss: 複雑な攻撃パターン
- [ ] **敵AI行動パターン**
  - 移動パターンのバリエーション
  - 攻撃パターン
  - 難易度スケーリング

### Phase 4: 高度なゲーム機能
- [ ] **ステート管理強化**
  - Redux Toolkit導入
  - ゲームステート永続化
- [ ] **ハイスコアシステム**
  - LocalStorage保存
  - スコアランキング
  - 統計情報
- [ ] **レベル・ステージシステム**
  - ステージ進行
  - 難易度カーブ
  - ボス戦

### Phase 5: 視覚・音響効果
- [ ] **PixiJS導入**
  - Canvas 2DからPixiJSへ移行
  - パフォーマンス最適化
- [ ] **視覚エフェクト**
  - パーティクルシステム
  - 爆発エフェクト
  - 背景スクロール
- [ ] **サウンドシステム**
  - 効果音
  - BGM
  - オーディオ設定

### Phase 6: PWA機能
- [ ] **Service Worker**
  - オフライン対応
  - キャッシュ戦略
- [ ] **Web App Manifest**
  - インストール可能
  - アプリアイコン
- [ ] **設定機能**
  - グラフィック品質調整
  - 音量設定
  - 操作設定

### Phase 7: 最適化・品質向上
- [ ] **パフォーマンス最適化**
  - オブジェクトプーリング
  - メモリ管理
  - 60FPS維持
- [ ] **テスト実装**
  - ユニットテスト
  - E2Eテスト
- [ ] **アクセシビリティ**
  - 音声サポート
  - キーボード操作

## 🎮 ゲームルール仕様

### 基本ルール（Phase 3更新版）
1. **操作方法**: 画面下部でのタッチによる左右移動のみ
2. **射撃**: 自動連射（手動操作不要）
3. **敵撃破**: 上から降ってくる敵を撃破してスコア獲得
   - Basic・Fast敵: 1発で撃破
   - Tank敵: 3発で撃破
   - Boss敵: 5発で撃破
4. **ダメージ**: 敵との接触で20HP減少（無敵時間1秒）
5. **ゲームオーバー条件**: 
   - HPが0になる
   - **敵がプレイヤーエリア（画面下部80%ライン）に到達した瞬間に即座にゲームオーバー**
   - この条件は最優先で、他の処理より先にチェックされる

### 操作仕様詳細
- **プレイヤー位置**: 画面下部20%エリアに固定
- **移動範囲**: 左右のみ（上下移動なし）
- **操作方法**: タッチした位置の真上にプレイヤーが移動
- **連射設定**: 初期200ms間隔、攻撃力に応じて最大100ms間隔まで短縮

### パワーアップシステム
1. 敵撃破時に一定確率でアイテム出現
2. **弾で撃破**: 正の効果（攻撃力アップ、HP回復、シールド等）
3. **直接触れる**: 負の効果（攻撃力ダウン）
4. リスク&リワードの戦略性

### スコアシステム
- **敵撃破**: 100ポイント × レベル倍率
- **パワーアップ取得**: 50ポイント
- **生存時間**: 1秒あたり1ポイント
- **連続撃破**: コンボ倍率（実装予定）

### 難易度設計
- **レベル1-5**: 敵出現間隔1.5秒→1.0秒に短縮、速度1.5→2.5に上昇
- **レベル6-10**: 敵出現間隔1.0秒→0.7秒、速度2.5→3.5、複数敵同時出現
- **レベル11+**: 最高難易度維持、スコア倍率1.5倍

### バランス調整指標
- **生存時間**: 初心者30秒、中級者2分、上級者5分以上
- **スコア分布**: 1,000(初心者) - 10,000(中級者) - 50,000+(上級者)
- **パワーアップ依存度**: 攻撃力20以上で高レベル対応可能
- **防衛戦略**: 敵の画面下部到達を防ぐ戦略性重視

## 📱 非機能要件

### パフォーマンス要件
- **フレームレート**: 安定した60FPS
- **読み込み時間**: 初回読み込み3秒以内
- **メモリ使用量**: 200MB以下
- **バッテリー消費**: 効率的な描画処理

### 対応環境
- **スマートフォン**: iOS Safari 14+, Android Chrome 80+
- **タブレット**: iPad Safari, Android Chrome
- **デスクトップ**: Chrome, Firefox, Safari (タッチシミュレーション)

### 品質要件
- **可用性**: 99.9%稼働率
- **セキュリティ**: XSS対策、CSP設定
- **アクセシビリティ**: WCAG 2.1 AA準拠
- **SEO**: PWA最適化

## 🔄 継続的開発要件

### デプロイメント
- **CI/CD**: GitHubへのプッシュで自動デプロイ
- **環境**: Vercel本番環境
- **バージョン管理**: セマンティックバージョニング
- **ロールバック**: 即座に前バージョンへ復旧可能

### 監視・分析
- **エラー監視**: 実行時エラーの追跡
- **パフォーマンス監視**: Core Web Vitals
- **ユーザー分析**: プレイ時間、スコア分布
- **A/Bテスト**: 機能改善のための実験

### 保守性
- **コード品質**: TypeScript, ESLint, Prettier
- **テストカバレッジ**: 80%以上
- **ドキュメント**: 自動生成API docs
- **リファクタリング**: 定期的な技術的負債解消

## 📈 成功指標

### エンゲージメント指標
- **月間アクティブユーザー**: 1,000人以上
- **平均セッション時間**: 5分以上
- **リテンション率**: 3日後50%以上
- **PWAインストール率**: 20%以上

### 技術指標
- **ページ読み込み速度**: Lighthouse Score 90以上
- **クラッシュ率**: 0.1%以下
- **バグ報告**: 月間5件以下
- **デプロイ頻度**: 週1回以上

## 🛡️ リスク管理

### 技術リスク
- **パフォーマンス劣化**: 段階的実装で監視
- **ブラウザ互換性**: Progressive Enhancement
- **セキュリティ脆弱性**: 定期的な依存関係更新

### プロジェクトリスク
- **スコープクリープ**: Phase分割による制御
- **技術的負債**: 定期的なリファクタリング
- **ユーザーフィードバック**: 早期・頻繁なリリース

---

**策定日**: 2025/01/14  
**承認者**: 開発チーム  
**次回レビュー**: Phase 2実装完了後